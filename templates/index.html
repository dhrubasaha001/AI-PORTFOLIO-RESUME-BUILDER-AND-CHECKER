<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareerBot AI Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body class="bg-slate-50 min-h-screen p-4 md:p-10 font-sans">

    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="space-y-6">
            <div class="flex items-center space-x-3">
                <div class="bg-indigo-600 p-2 rounded-lg text-white font-bold text-xl italic">CB</div>
                <h1 class="text-3xl font-black text-slate-900 tracking-tighter uppercase">CareerBot <span class="text-indigo-600">Pro</span></h1>
            </div>
            
            <div class="bg-white p-8 rounded-3xl shadow-xl border border-slate-200">
                <h3 class="font-bold text-slate-800 mb-6 flex items-center">
                    <span class="mr-2 text-indigo-600">01.</span> Personal Details
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <input id="name" type="text" placeholder="Full Name" class="p-3 border rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none">
                    <input id="phone" type="text" placeholder="Mobile Number" class="p-3 border rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none">
                    <input id="email" type="email" placeholder="Email Address" class="p-3 border rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none">
                    <input id="education" type="text" placeholder="Education (College/Degree)" class="p-3 border rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <input id="github" type="text" placeholder="GitHub URL" class="p-3 border rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none">
                    <input id="linkedin" type="text" placeholder="LinkedIn URL" class="p-3 border rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none">
                </div>

                <h3 class="font-bold text-slate-800 mb-4 flex items-center">
                    <span class="mr-2 text-indigo-600">02.</span> Professional Info
                </h3>
                <div class="space-y-4">
                    <textarea id="skills" placeholder="Skills (Python, Java, React...)" class="w-full p-3 border rounded-xl h-24 focus:ring-2 focus:ring-indigo-500 outline-none"></textarea>
                    <textarea id="projects" placeholder="Project Details (What did you build?)" class="w-full p-3 border rounded-xl h-32 focus:ring-2 focus:ring-indigo-500 outline-none"></textarea>
                    <button id="gen-btn" onclick="runTask('generate')" class="w-full bg-indigo-600 text-white font-bold py-4 rounded-2xl hover:bg-indigo-700 transition-all shadow-lg hover:shadow-indigo-200">‚ú® Generate Professional Resume</button>
                </div>
            </div>

            <div class="bg-white p-8 rounded-3xl shadow-xl border border-slate-200">
                <h3 class="font-bold text-slate-800 mb-4 italic">ATS Optimization Mode</h3>
                <textarea id="resume_text" placeholder="Paste your current resume text here to analyze..." class="w-full p-3 border rounded-xl h-32 mb-4"></textarea>
                <button id="chk-btn" onclick="runTask('check')" class="w-full bg-slate-900 text-white font-bold py-3 rounded-2xl hover:bg-black transition">üîç Check ATS Compatibility</button>
            </div>
        </div>

        <div class="relative">
            <div class="bg-white min-h-[800px] p-10 rounded-3xl shadow-2xl border border-slate-200 sticky top-6">
                <div class="flex justify-between items-center border-b pb-6 mb-8">
                    <h3 class="font-black text-slate-400 uppercase text-xs tracking-[0.2em]">Document Preview</h3>
                    <div class="flex space-x-2">
                        <button onclick="copyOut()" class="px-4 py-2 text-xs font-bold border rounded-lg hover:bg-slate-50 transition">Copy</button>
                        <button id="download-btn" onclick="downloadPDF()" class="px-4 py-2 text-xs font-bold bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition hidden">Download PDF</button>
                    </div>
                </div>
                
                <div id="loader" class="hidden text-center py-40">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"></div>
                    <p class="text-slate-500 font-medium italic">Groq AI is crafting your resume...</p>
                </div>

                <div id="output" class="prose prose-slate max-w-none text-slate-800"></div>
            </div>
        </div>
    </div>

    <script>
        async function runTask(type) {
            const btn = type === 'generate' ? document.getElementById('gen-btn') : document.getElementById('chk-btn');
            const out = document.getElementById('output');
            const loader = document.getElementById('loader');
            const downloadBtn = document.getElementById('download-btn');
            
            btn.disabled = true;
            loader.classList.remove('hidden');
            out.innerHTML = "";
            downloadBtn.classList.add('hidden');

            const payload = type === 'generate' ? {
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                education: document.getElementById('education').value,
                github: document.getElementById('github').value,
                linkedin: document.getElementById('linkedin').value,
                skills: document.getElementById('skills').value,
                projects: document.getElementById('projects').value
            } : { resume_text: document.getElementById('resume_text').value };

            try {
                const response = await fetch(`/${type}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                
                loader.classList.add('hidden');
                if(result.success) {
                    out.innerHTML = marked.parse(result.data);
                    if(type === 'generate') downloadBtn.classList.remove('hidden');
                } else {
                    out.innerHTML = `<div class="p-4 bg-red-50 text-red-600 rounded-xl font-bold">‚ö†Ô∏è Error: ${result.error}</div>`;
                }
            } catch (e) {
                loader.classList.add('hidden');
                out.innerText = "Fatal Error: Backend Connection Lost.";
            }

            setTimeout(() => { btn.disabled = false; }, 3000);
        }

        function copyOut() {
            const text = document.getElementById('output').innerText;
            navigator.clipboard.writeText(text);
            alert("Resume copied to clipboard!");
        }

        function downloadPDF() {
            const element = document.getElementById('output');
            const name = document.getElementById('name').value || 'Resume';
            
            const opt = {
                margin:       [0.5, 0.5],
                filename:     `${name}_AI_Resume.pdf`,
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2, useCORS: true },
                jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
            };

            // Use html2pdf to generate and save
            html2pdf().set(opt).from(element).save();
        }
    </script>
</body>
</html>